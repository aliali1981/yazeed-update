<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>نظام مدرسة يزيد بن الحارث | الرسمي</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
    
    <script src="https://www.gstatic.com/firebasejs/9.1.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.1/firebase-firestore-compat.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.5/xlsx.full.min.js"></script>

    <style>
        :root { 
            --primary: #004a99; 
            --secondary: #28a745; 
            --bg: #f0f4f8; 
            --error: #dc3545;
        }

        body { 
            font-family: 'Cairo', sans-serif; 
            background-color: var(--bg); 
            margin: 0; padding: 10px; 
            text-align: right; 
            position: relative;
            min-height: 100vh;
        }

        /* إضافة العلامة المائية في خلفية الصفحة */
        body::before {
            content: "";
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 400px; /* حجم العلامة المائية */
            height: 400px;
            background-image: url('logo.png'); /* تأكد من وجود ملف الشعار بنفس الاسم */
            background-repeat: no-repeat;
            background-position: center;
            background-size: contain;
            opacity: 0.05; /* درجة الشفافية: خفيفة جداً لضمان وضوح النص */
            z-index: -1; /* خلف كل المحتويات */
            pointer-events: none;
        }

        .container { 
            max-width: 850px; 
            margin: 20px auto; 
            background: rgba(255, 255, 255, 0.95); /* شفافية بسيطة للمحتوى */
            padding: 30px; 
            border-radius: 25px; 
            box-shadow: 0 15px 50px rgba(0,0,0,0.1); 
            border-top: 10px solid var(--primary);
            backdrop-filter: blur(5px);
        }

        .header-logos { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; }
        .logo { width: 85px; height: auto; z-index: 2; }

        /* تنسيق بطاقات الصفوف */
        .class-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(130px, 1fr)); 
            gap: 12px; 
            margin: 20px 0; 
        }

        .class-card { 
            background: #fff; 
            border: 2px solid #edf2f7; 
            padding: 18px 10px; 
            border-radius: 15px; 
            text-align: center; 
            cursor: pointer; 
            transition: 0.3s; 
            font-weight: 700;
            color: #4a5568;
        }

        .class-card:hover { border-color: var(--primary); transform: translateY(-3px); }
        .class-card.active { 
            background: var(--primary); 
            color: white; 
            border-color: var(--primary);
            box-shadow: 0 10px 20px rgba(0,74,153,0.2);
        }

        .form-group { margin-bottom: 25px; }
        label { display: block; margin-bottom: 10px; font-weight: 700; color: var(--primary); }
        
        select, input { 
            width: 100%; padding: 15px; 
            border: 2px solid #edf2f7; 
            border-radius: 12px; 
            font-size: 16px; 
            font-family: 'Cairo';
            box-sizing: border-box;
        }

        .invalid-feedback { color: var(--error); font-size: 13px; margin-top: 5px; display: none; }

        .btn-submit { 
            width: 100%; padding: 18px; 
            background: linear-gradient(135deg, var(--secondary) 0%, #218838 100%); 
            color: white; border: none; 
            border-radius: 15px; font-size: 1.1em; font-weight: 700; 
            cursor: pointer; box-shadow: 0 8px 20px rgba(40, 167, 69, 0.3);
        }

        .school-footer { 
            text-align: center; 
            margin-top: 40px; 
            padding-top: 20px; 
            border-top: 1px solid #eee; 
        }
        .manager-name { color: var(--primary); font-size: 20px; font-weight: 700; }

        #successModal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.7); display: none;
            justify-content: center; align-items: center; z-index: 9999;
        }
        .modal-content {
            background: white; padding: 40px; border-radius: 20px; text-align: center;
            max-width: 90%; width: 400px;
        }

        .hidden { display: none; }
    </style>
</head>
<body>

<div class="container" id="userView">
    <div class="header-logos">
        <img src="وزارة التعليم.png" alt="وزارة التعليم" class="logo">
        <img src="logo.png" alt="شعار المدرسة" class="logo">
    </div>

    <div style="text-align: center; margin-bottom: 30px;">
        <h2 style="color: var(--primary); margin: 0;">مدرسة يزيد بن الحارث (5-8)</h2>
        <p style="color: #666; font-size: 14px;">استمارة تحديث أرقام هواتف أولياء الأمور</p>
    </div>

    <form id="updateForm">
        <label>1. اختر الصف الدراسي:</label>
        <div class="class-grid">
            <div class="class-card" onclick="selectClass(this, '5_1', 'الخامس أول')">الخامس أول</div>
            <div class="class-card" onclick="selectClass(this, '5_2', 'الخامس ثاني')">الخامس ثاني</div>
            <div class="class-card" onclick="selectClass(this, '5_3', 'الخامس ثالث')">الخامس ثالث</div>
            <div class="class-card" onclick="selectClass(this, '6_1', 'السادس أول')">السادس أول</div>
            <div class="class-card" onclick="selectClass(this, '6_2', 'السادس ثاني')">السادس ثاني</div>
            <div class="class-card" onclick="selectClass(this, '7_1', 'السابع أول')">السابع أول</div>
            <div class="class-card" onclick="selectClass(this, '7_2', 'السابع ثاني')">السابع ثاني</div>
            <div class="class-card" onclick="selectClass(this, '7_3', 'السابع ثالث')">السابع ثالث</div>
            <div class="class-card" onclick="selectClass(this, '8_1', 'الثامن أول')">الثامن أول</div>
            <div class="class-card" onclick="selectClass(this, '8_2', 'الثامن ثاني')">الثامن ثاني</div>
        </div>

        <input type="hidden" id="classInput" required>
        <input type="hidden" id="classNameInput">

        <div id="nextSteps" class="hidden">
            <div class="form-group">
                <label>2. اسم الطالب الثلاثي والقبيلة:</label>
                <select id="studentSelect" required></select>
            </div>

            <div class="form-group">
                <label>3. صلة القرابة:</label>
                <select id="relation">
                    <option>الأب</option>
                    <option>الأم</option>
                    <option>ولي الأمر</option>
                </select>
            </div>

            <div class="form-group">
                <label>4. رقم الهاتف (8 أرقام):</label>
                <input type="tel" id="newPhone" placeholder="9xxxxxxx" maxlength="8" required>
                <div id="phoneError" class="invalid-feedback">يرجى إدخال رقم صحيح يبدأ بـ 9 أو 7</div>
            </div>

            <button type="submit" class="btn-submit" id="submitBtn">إرسال التحديث الآن</button>
        </div>
    </form>

    <div class="school-footer">
        <div style="color: #888; font-size: 13px;">تحت إشراف مدير المدرسة</div>
        <div class="manager-name">الأستاذ هشام الكحالي</div>
    </div>
</div>

<div id="successModal">
    <div class="modal-content">
        <div style="font-size: 60px; color: var(--secondary);">✔</div>
        <h2 style="color: var(--primary);">تم الاستلام بنجاح</h2>
        <p>شكرًا لتعاونكم معنا في تحديث بيانات التواصل الخاصة بالطالب.</p>
        <button onclick="location.reload()" class="btn-submit">عودة للرئيسية</button>
    </div>
</div>

<script>
    // --- الربط التقني بـ Firebase ---
    const firebaseConfig = {
        apiKey: "AIzaSyBQsjvkdmYaR6OOGAbG-WdqIJCiHbw_Avo",
        authDomain: "madrassa-yazeed.firebaseapp.com",
        projectId: "madrassa-yazeed",
        storageBucket: "madrassa-yazeed.firebasestorage.app",
        messagingSenderId: "1025900552589",
        appId: "1:1025900552589:web:1634648a6b6a8b4b05ddc4"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const studentsData = {
        "5_1": ["أحمد بن سالم بن سعيد حسن خوار", "الامين محمد احمد الطيب", "تركي بن محمد بن سعيد مسلم مسن", "خالد بن راشد بن سعيد سالم مسن", "سالم بن محمد بن سالم صالح جداد", "سالم بن مسلم بن سهيل محمد الراشدي", "سعود بن سالم بن ظويهر سالم جداد", "سعود بن شهاب بن نافع مسلم المسهلي الكثيري", "سعيد بن عبدالله بن بقال خويدع خوار", "سلطان بن محمد بن علي مهوي العامري", "عامر بن سهيل بن عامر سليّم قمصيت", "عبدالرحمن احمد فوزي عبدالفتاح", "علي بن سعد بن مسلم سعيد الراشدي", "عوض بن محمد بن عوض خادم الوهيبي", "غانم بن محمد بن سليم مسلم الجنيبي", "غانم بن محمد بن مبارك بخيت جداد", "محمد احمد محمود عبدالحميد", "محمد بن مسلم بن محمد بخيت مسن", "نايف بن محمد بن سالم سهيل مسن", "همدان بن احمد بن عبدالله محمد جداد"],
        "5_2": ["أحمد بن سعيد بن مسلم أحمد جداد", "أمجد بن سعيد بن خميس سعيد الشكيلي", "البراء احمد سميح علي سيد", "خالد بن أحمد بن مسلم محمد مسن", "خالد بن محمد بن مسلم سنكور خوار", "سالم بن حمد بن مبخوت حماده جداد", "سالم بن عوض بن سالم محمد مسن", "سالم بن نايف بن سالم عيضه جداد", "سعيد بن بخيت بن عبدي بخيت خوار", "سعيد بن خالد بن بخيت زايد مسن", "سعيد بن صالح بن سهيل علي بيت جداد", "سلمان بن ناجي بن سالم سعد خوار", "سهيل بن معمر بن سهيل مسلم جداد الكثيري", "صالح يحيى مسلم", "صقر بن محمد بن العبد سهيل جداد", "عبدالرحمن سامي محمد احمد يوسف المزين", "محمد بن بخيت بن احمد محمد مسن", "محمد بن سالم بن سهيل مطر جداد", "محمد بن عامر بن محمد احمد المسهلي", "محمد بن غازي بن كفيش جعيد جداد الكثيري", "محمد بن فهد بن سالم خويتم مسن", "مسلم بن بخيت بن عبدي بخيت خوار"],
        "5_3": ["إلياس بن ابراهيم بن حمد مسعود العامري", "تيمور بن أحمد بن مبروك أحمد مسن", "خالد أحمد حسن التابعي", "خالد بن عمرو بن غفيل سالم خوار", "سامي بن عماد الميساوي", "شهاب بن حمد بن محمد حمد الهنائي", "عبدالله بن محمد بن عيظه سعيد جداد الكثيري", "فهد بن محمد بن سالم مسلم المسهلي", "فيصل بن حمد بن محمد حمد الهنائي", "مازن مصطفى محمد احمد على", "محمد بن حسين بن سالم مبخوت خوار", "محمد بن سعيد بن سالم خويتم مسن", "مروان سلامه حسين علي شليل", "مسلم بن سعيد بن سعد سعيد جداد", "مسلم بن محمد بن مسلم احمد جداد", "هيثم بن فواز بن سليمان عبدالله الهاشمي"],
        "6_1": ["الخطاب محمد حمد النيل احمد", "الخليل بن غسان بن طالب بدر الصمصامي", "الهجرس بن سليمان بن مبارك سليمان الحبسي", "انس محمود محمد احمد", "اواب عبدالعظيم حسين الطاهر", "حسين محمد يوسف خضر", "سالم بن ثاني بن محمد بخيت خوار", "سالم بن حمود بن سالم سعيد الوائلي", "سالم بن محمد بن سالم عبدالله الراشدي", "سعود بن عبدالعزيز بن بخيت حم مسن", "سعيد بن حاتم بن سعيد محمد بيت مسن", "سعيد بن مسلم بن سعيد سهيل مسن", "سهيل بن سليم بن سهيل سليم قمصيت", "سهيل محسن سهيل ال خوار", "سيف بن خميس بن سالم محمد الجنيبي", "سيف بن نائف بن عبدالله مبارك جداد", "عبد الرحمن بن محمد بن سعيد سالم مسن", "عبدالله بن غانم بن سالم عبدالله الراشدي", "عبدالله بن محمد بن احمد رويكان خوار", "عبدالله عواض عبدالله عبداللطيف", "علي بن حامد بن مسلم محمد مسن الكثيري", "علي بن سعيد بن محمد سالم خوار", "مبروك بن محمد بن سالم ظويهر جداد", "متعب بن سعيد بن عبدالله محمد جداد", "محمد بن جميل بن عبدي بخيت خوار", "مسلم بن بدر بن مسلم سعيد مسن", "مسلم بن محمد بن مسلم سعيد جداد"],
        "6_2": ["الليث بن إبراهيم بن ناصر علي الحوسني", "المغيره بشرى محجوب احمد", "بخيت بن سعيد بن مبارك بخيت جداد", "سالم بن احمد بن سهيل سالم خوار", "سالم بن حاتم بن سالم سعد خوار", "سالم بن سلطان بن سليّم غانم الراشدي", "سالم بن سهيل بن سالم المحناء جداد", "سعد بن كرامه بن سالم علي خوار", "سعيد بن عادل بن سالم خويتم مسن بيت كثير", "سلطان بن مسلم بن سلطان اسد الراشدي", "عامر بن خالد بن سالم مسن", "عبدالله بن حسين بن علي محمد ال عبدالسلام", "عبدالله بن عبدي بن بخيت زولة خوار", "عبدالله سعيدان سيعد الراشدي", "غازي بن محمد بن صالح احمد جداد", "غيث بن احمد بن بخيت معيوف المسهلي", "مازن تامر محمد محمد علوش", "مازن عبدالسميع سليمان خميس", "ماهر بن محمد بن مستهيل محمد صفرار", "محمد بن عبدالله بن محمد عبدالله خوار", "محمد حافظ سعيد رعفيت", "محمد محسن سهيل ال خوال", "مدرك بن خالد بن سعيد بخيت الشعشعي", "مسلم بن سالم بن عبدالله سعيد الراشدي", "مسلم بن محمد بن سعيد مسلم جداد", "يوسف بن محمد بن بخيت سالم خوار", "يوسف عماد الميساوي"],
        "7_1": ["احمد امجد احمد أحمد نجاد", "أحمد بن سعيد بن صالح أحمد جداد", "العبد بن محمد بن العبد زائد مسن", "النابي بن محمد بن سالم سهيل مسن", "بخيت بن احمد بن بخيت فريح مسن الكثيري", "تميم بن محمد بن سهيل جديد جداد الكثيري", "تميم بن محمد بن مبروك عبدالله المسهلي", "حمد بن محمد بن احمد الهزار الكثيري", "حمد بن محمد بن سعيد مسن", "راشد بن محمد بن أحمد محمد مسن الكثيري", "سالم بن سعد بن صلاح رعفيت", "سعيد بن شهاب بن احمد محمد مسن", "سعيد بن محمد بن صالح جداد", "سعيد بن محمد بن مبارك بخيت جداد", "سلطان بن حمزة بن مسلم نفل ربعات الكثيري", "عامر بن محمد بن مسلم بخيت المسهلي", "عبدالله بن سالم بن سهيل سليم قمصيت", "عمر احمد محمد احمد", "عمر عبدالقوى ابراهيم ابراهيم", "فريح بن عبدالله بن فريح احمد مسن", "مجتبى عيسى محمد", "مسلم بن محمد بن عوض خادم الوهيبي", "نصر بن سالم بن ظويهر سالم جداد", "ياسر بن عادل بن سالم مسن بيت كثير", "يوسف عمر احمد عبد الرحمن حاكم"],
        "7_2": ["ابراهيم محمد سالم السطري", "العباس بن مبخوت بن سالم مسن بيت كثير", "المنذر بن فواز بن سليمان عبدالله الهاشمي", "امير بن ناصر بن عبدالرحمن عبدالله البلوشي", "حسين سلامه حسين علي شليل", "خالد بن سالم بن علي عبدالله العلوي", "خالد بن محمد بن سهيل مطر جداد", "خالد بن مسلم بن أحمد جداد", "رويزم بن مسلم بن بخيت رويزم صندل المحرمي", "سالم بن مبارك بن سهيل محمد الراشدي", "سعد بن محمد بن سعد حفيظ خوار", "سعود بن عبدالله بن بخيت زايد مسن", "سعيد بن عبدالله بن سالم احمد جداد", "سعيد بن مسلم بن عبدالله سعيد جداد", "سلطان بن مسلم بن سالم صالح جداد", "عبدالله بن عارف بن سالم جداد", "علي بن سعيد بن علي خوار", "عمر فؤاد فهمي محمد فؤاد", "فهد بن غانم بن سالم جداد", "محسن معتصم محمد الامام", "محمد بن سالم بن مبخوت محمد الراشدي", "مسلم بن سالم بن سهيل الراشدي", "مصطفى محمود كريم ابراهيم احمد", "معاذ احمد سميح علي سيد", "منيف بن سعيد بن محمد سالم جداد", "هادف بن سعيد بن هادف حسن شحري خوار", "وائل بن حمود بن سالم سعيد الوائلي"],
        "7_3": ["أحمد بن نائف بن عبدالله محمد جداد", "الطلح بن سالم بن حسن علي خوار", "بخيت بن مسلم سالم مبخوت الراشدي", "بدر بن عامر بن مسلم الرحابه جداد", "حثيث بن سلطان بن محمد سهيل مسن", "حمد بن محمد بن عبدالله محمد جداد الكثيري", "سالم بن احمد بن سالم جداد", "سعيد بن مبروك بن سالم عامر المسهلي", "سهيل بن عبدالله بن سهيل حافظ خوار", "عبد الله أمير عبدالله نصر", "عبدالله بن محمد بن علي مهوي العامري", "علي بن ثاني بن علي سالم جداد بيت كثير", "فارس زياد محمد ابو رواع", "مبارك بن سعيد بن سالم خويتم مسن", "محسن بن عقيل بن سالم سعد خوار", "محمد بن بخيت بن فرج السنح شهوان المهري", "محمد بن علي بن بخيت محمد الراشدي", "محمد بن غانم بن الرضه سلاوم جداد", "محمد بن مسلم بن محمد مسلم جداد", "محمد بن ناصر بن عبدالله جداد", "محمد بن هيثم بن سالم فائل جداد الكثيري", "مسلم بن حسن بن هادف حسن شحري خوار", "معاذ فؤاد الحنيش الاحمد", "ناصر بن علي بن ناصر سهيل جداد", "نور الدين محسن العلي", "هيثم بن محمد بن سالم فائل جداد"],
        "8_1": ["أحمد بن سعيد بن بخيت صندل المحرمي", "أحمد بن عامر بن محمد سالم خوار", "أحمد بن محمد بن سالم مبارك المسهلي", "المر بن غانم بن محمد سهيل المسهلي الكثيري", "اياد احمد توفيق عباس مصطفى", "بخيت بن خالد بن بخيت زايد مسن", "بخيت بن سعيدان بن بخيت رويزم صندل المحرمي", "حاكم بن فهد بن سالم خويتم مسن", "حريز بن محسن بن صالح حريز خوار", "حمد بن محمد بن العبد سهيل جداد", "حمد بن محمد بن سعد سعيد جداد", "حمدان بن محمد بن عبدالله محمد جداد", "زايد بن محمد بن مسلم سعيد جداد", "سعود بن أحمد بن محمد الطوف الهزار الكثيري", "سعود بن حاتم بن سعيد محمد بيت مسن", "سعود بن محمد بن صالح احمد جداد", "سعيد بن عبدالله بن مبخوت حماده جداد", "سهيل بن صالح بن بخيت صالح منيف خوار", "سهيل بن محسن بن سليم محفوظ خوار", "سهيل بن محمد بن سالم علي الحمر", "سيف بن عبدالله بن مسلم محمد مسن الكثيري", "فائل بن محمد بن فائل مطر جداد", "محمد اسماعيل ادم على", "محمد بن سالم بن سعيد المحناء جداد", "محمد بن سعد بن مسلم سعيد الراشدي", "محمد بن مسلم بن سعيد بخيت مسن", "محمد بن مسلم بن سهيل مطر جداد", "محمد مصطفى عبدالنبي عبده", "مسلم بن حمد بن سلوم مسلم الجنيبي", "مطر بن علي بن سالم عامر المسهلي", "ناصر بن سالم بن محمد الطوف الكثيري", "صالح جعفر صالح عبد الله"],
        "8_2": ["الجلندى بن يقظان بن سليمان سالم الناصري", "الخطاب محمد صلاح محمود", "تميم بن هيثم بن احمد سعيد مسن الكثيري", "خالد بن محمد بن سالم احمد جداد", "خالد بن نايف بن سالم عيضه جداد", "ركاض بن بخيت بن فرج شهوان عزاب", "سالم بن حامد بن مسلم محمد مسن الكثيري", "سالم بن عامر بن سالم ظويهر جداد", "سالم سهيل سالم فرج الخوار", "سعد بن حاكم بن أحمد خوار", "سعود بن سالم بن سعيد سهيل مسن", "سعود بن نائف بن عبدالله محمد جداد", "سعيد بن راكان بن مسلم محمد مسن الكثيري", "صالح بن علي بن صالح علي المسهلي", "طارق احمد ضاحي عبدالغني حسين", "طلال بن مسلم بن سعيد سهيل مسن", "عامر بن احمد بن مبخوت مسلم منيف خوار", "عبدالعزيز بن فيصل بن سعيد محمد المسهلي", "عبدالله بن سالم بن أحمد صالح مسن", "علي جمعان سالم سعيد موسى", "عمر بن محمد بن سليمان محمد الفهدي", "غفيل بن عمرو بن غفيل سالم خوار", "مالك وليد محمد فواد", "محمد بن سعيد بن صالح أحمد جداد", "محمد بن مسلم بن سهيل محمد الراشدي", "مسلم بن احمد بن muslim الرحابه جداد", "ناصر بن مرشد بن بخيت عبدالله مسن", "يام بن محمد بن سالم بخيت الكثيري", "يوسف بن سالم بن عامر سلاوم جداد", "محمد حسين العلي"]
    };

    function selectClass(el, code, name) {
        document.querySelectorAll('.class-card').forEach(c => c.classList.remove('active'));
        el.classList.add('active');
        document.getElementById('classInput').value = code;
        document.getElementById('classNameInput').value = name;
        
        const sel = document.getElementById('studentSelect');
        sel.innerHTML = '<option value="" disabled selected>-- اختر الطالب من هنا --</option>';
        studentsData[code].forEach(s => {
            let o = document.createElement('option'); o.value = s; o.innerText = s; sel.appendChild(o);
        });

        document.getElementById('nextSteps').classList.remove('hidden');
    }

    // التحقق الفوري من رقم الهاتف
    document.getElementById('newPhone').addEventListener('input', function(e) {
        const val = e.target.value;
        const err = document.getElementById('phoneError');
        if (val.length > 0 && !/^[79]/.test(val)) {
            err.style.display = 'block';
            this.style.borderColor = 'var(--error)';
        } else {
            err.style.display = 'none';
            this.style.borderColor = '#edf2f7';
        }
    });

    document.getElementById('updateForm').onsubmit = async (e) => {
        e.preventDefault();
        const phone = document.getElementById('newPhone').value;
        
        if (!/^[79][0-9]{7}$/.test(phone)) {
            alert("عذراً، يجب أن يتكون رقم الهاتف من 8 أرقام ويبدأ بـ 9 أو 7");
            return;
        }

        const btn = document.getElementById('submitBtn');
        btn.disabled = true; btn.innerText = "جاري الحفظ الموثوق...";

        try {
            await db.collection("updates").add({
                classCode: document.getElementById('classInput').value,
                className: document.getElementById('classNameInput').value,
                studentName: document.getElementById('studentSelect').value,
                phoneNumber: phone,
                relation: document.getElementById('relation').value,
                timestamp: new Date().toLocaleString('ar-OM')
            });
            document.getElementById('successModal').style.display = 'flex';
        } catch(e) { 
            alert("حدث خطأ في الشبكة، يرجى المحاولة مرة أخرى."); 
            btn.disabled = false; 
        }
    };
</script>
</body>
</html>
