<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ูุธุงู ูุฏุฑุณุฉ ูุฒูุฏ ุจู ุงูุญุงุฑุซ - ุชุญุฏูุซ ุงูุจูุงูุงุช</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.1.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.1/firebase-firestore-compat.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.5/xlsx.full.min.js"></script>

    <style>
        :root { --primary: #004a99; --secondary: #28a745; --bg: #f4f7f9; --accent: #ffc107; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background-color: var(--bg); margin: 0; padding: 15px; text-align: right; }
        .container { max-width: 900px; margin: 10px auto; background: #fff; padding: 25px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); border-top: 6px solid var(--primary); }
        .header-logos { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .logo { width: 85px; height: auto; }
        .header-text { text-align: center; margin-bottom: 25px; border-bottom: 2px solid #eee; padding-bottom: 15px; }
        .form-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 8px; font-weight: bold; color: #333; }
        select, input { width: 100%; padding: 12px; border: 1px solid #ccc; border-radius: 8px; font-size: 15px; box-sizing: border-box; }
        .hidden { display: none; }
        .btn-submit { width: 100%; padding: 15px; background: var(--secondary); color: white; border: none; border-radius: 8px; font-size: 18px; font-weight: bold; cursor: pointer; transition: 0.3s; }
        .btn-submit:hover { opacity: 0.9; }
        
        /* ููุญุฉ ุงูุชุญูู */
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 25px; }
        .stat-card { background: white; border: 1px solid #ddd; border-radius: 10px; padding: 15px; box-shadow: 2px 2px 8px rgba(0,0,0,0.05); }
        .progress-bar { width: 100%; background: #eee; height: 10px; border-radius: 5px; margin-top: 8px; overflow: hidden; }
        .progress-fill { background: var(--secondary); height: 100%; transition: width 0.5s; }
        .admin-header { display: flex; justify-content: space-between; align-items: center; background: var(--primary); color: white; padding: 15px; border-radius: 10px; margin-bottom: 20px; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; font-size: 13px; }
        th, td { border: 1px solid #ddd; padding: 12px; text-align: right; }
        th { background: #f8f9fa; color: var(--primary); }
        .search-box { width: 100%; padding: 12px; margin-bottom: 20px; border: 2px solid var(--primary); border-radius: 8px; }
        .admin-login-btn { background: none; border: none; color: #eee; cursor: pointer; float: left; font-size: 10px; }
    </style>
</head>
<body>

<div class="container" id="userView">
    <button class="admin-login-btn" onclick="openAdmin()">Admin Login</button>
    <div class="header-logos">
        <img src="ูุฒุงุฑุฉ ุงูุชุนููู.png" alt="ูุฒุงุฑุฉ ุงูุชุนููู" class="logo">
        <img src="logo.png" alt="ุดุนุงุฑ ุงููุฏุฑุณุฉ" class="logo">
    </div>
    <div class="header-text">
        <h2 style="color: var(--primary); margin:0;">ูุฏุฑุณุฉ ูุฒูุฏ ุจู ุงูุญุงุฑุซ ููุชุนููู ุงูุฃุณุงุณู</h2>
        <p>ุชุญุฏูุซ ูุงุนุฏุฉ ุจูุงูุงุช ุฃุฑูุงู ุงูููุงุชู (2025-2026)</p>
    </div>

    <form id="updateForm">
        <div class="form-group">
            <label>1. ุงุฎุชุฑ ุงูุตู ุงูุฏุฑุงุณู:</label>
            <select id="classSelect" required onchange="populateStudents(this.value)">
                <option value="" disabled selected>-- ุญุฏุฏ ุงูุตู --</option>
                <option value="5_1">ุฎุงูุณ / 1</option><option value="5_2">ุฎุงูุณ / 2</option><option value="5_3">ุฎุงูุณ / 3</option>
                <option value="6_1">ุณุงุฏุณ / 1</option><option value="6_2">ุณุงุฏุณ / 2</option>
                <option value="7_1">ุณุงุจุน / 1</option><option value="7_2">ุณุงุจุน / 2</option><option value="7_3">ุณุงุจุน / 3</option>
                <option value="8_1">ุซุงูู / 1</option><option value="8_2">ุซุงูู / 2</option>
            </select>
        </div>
        <div class="form-group hidden" id="studentGroup">
            <label>2. ุงุณู ุงูุทุงูุจ:</label>
            <select id="studentSelect" required></select>
        </div>
        <div id="dataFields" class="hidden">
            <div class="form-group"><label>3. ุตูุฉ ุงููุฑุงุจุฉ:</label>
                <select id="relation"><option>ุงูุฃุจ</option><option>ุงูุฃู</option><option>ููู ุงูุฃูุฑ</option></select>
            </div>
            <div class="form-group"><label>4. ุฑูู ุงููุงุชู ุงูุฌุฏูุฏ:</label>
                <input type="tel" id="newPhone" placeholder="ุฅุฏุฎุงู 8 ุฃุฑูุงู" maxlength="8" required pattern="[97][0-9]{7}">
            </div>
            <button type="submit" class="btn-submit" id="submitBtn">ุฅุฑุณุงู ูุชุญุฏูุซ ุงูุจูุงูุงุช</button>
        </div>
    </form>
</div>

<div class="container hidden" id="adminView" style="max-width: 1100px;">
    <div class="admin-header">
        <h3 style="margin:0;">ููุญุฉ ุชุญูู ูุฏุฑุณุฉ ูุฒูุฏ</h3>
        <button onclick="location.reload()" style="background:white; color:red; border:none; padding:5px 15px; border-radius:5px; cursor:pointer;">ุฎุฑูุฌ</button>
    </div>

    <div class="stats-grid" id="statsContainer"></div>

    <div style="display:flex; gap:10px; margin-bottom:20px;">
        <input type="text" id="adminSearch" class="search-box" placeholder="๐ ุงุจุญุซ ุนู ุงุณู ุทุงูุจ ุฃู ุฑูู ูุงุชู..." onkeyup="searchTable()">
        <button onclick="exportToExcel()" style="background:var(--secondary); color:white; border:none; padding:10px 20px; border-radius:8px; cursor:pointer; font-weight:bold; white-space:nowrap;">๐ฅ ุชุตุฏูุฑ Excel</button>
    </div>

    <div style="overflow-x:auto; background:white; border-radius:10px;">
        <table id="dataTable">
            <thead>
                <tr>
                    <th>ุงูุชุงุฑูุฎ</th>
                    <th>ุงูุตู</th>
                    <th>ุงุณู ุงูุทุงูุจ</th>
                    <th>ุงูุฑูู ุงููุญุฏุซ</th>
                    <th>ุงูุตูุฉ</th>
                </tr>
            </thead>
            <tbody id="adminTableBody"></tbody>
        </table>
    </div>
</div>

<script>
    // ุฅุนุฏุงุฏุงุช Firebase
    const firebaseConfig = {
        apiKey: "AIzaSyBQsjvkdmYaR6OOGAbG-WdqIJCiHbw_Avo",
        authDomain: "madrassa-yazeed.firebaseapp.com",
        databaseURL: "https://madrassa-yazeed-default-rtdb.firebaseio.com",
        projectId: "madrassa-yazeed",
        storageBucket: "madrassa-yazeed.firebasestorage.app",
        messagingSenderId: "1025900552589",
        appId: "1:1025900552589:web:1634648a6b6a8b4b05ddc4",
        measurementId: "G-6E4JMBVCED"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // ุฃุนุฏุงุฏ ุงูุทูุงุจ ุงูุฅุฌูุงููุฉ ููุฅุญุตุงุฆูุงุช
    const classTotals = { "5_1": 20, "5_2": 22, "5_3": 16, "6_1": 27, "6_2": 27, "7_1": 25, "7_2": 27, "7_3": 26, "8_1": 32, "8_2": 30 };

    // ุจูุงูุงุช ุงูุทูุงุจ (ุณูุชู ุงุณุชูุฑุงุฏูุง ุจุงููุงูู ูู ุงูููุงุฆู)
    const studentsData = {
        "5_1": ["ุฃุญูุฏ ุจู ุณุงูู ุจู ุณุนูุฏ ุญุณู ุฎูุงุฑ", "ุงูุงููู ูุญูุฏ ุงุญูุฏ ุงูุทูุจ", "ุชุฑูู ุจู ูุญูุฏ ุจู ุณุนูุฏ ูุณูู ูุณู", "ุฎุงูุฏ ุจู ุฑุงุดุฏ ุจู ุณุนูุฏ ุณุงูู ูุณู", "ุณุงูู ุจู ูุญูุฏ ุจู ุณุงูู ุตุงูุญ ุฌุฏุงุฏ", "ุณุงูู ุจู ูุณูู ุจู ุณููู ูุญูุฏ ุงูุฑุงุดุฏู", "ุณุนูุฏ ุจู ุณุงูู ุจู ุธูููุฑ ุณุงูู ุฌุฏุงุฏ", "ุณุนูุฏ ุจู ุดูุงุจ ุจู ูุงูุน ูุณูู ุงููุณููู ุงููุซูุฑู", "ุณุนูุฏ ุจู ุนุจุฏุงููู ุจู ุจูุงู ุฎููุฏุน ุฎูุงุฑ", "ุณูุทุงู ุจู ูุญูุฏ ุจู ุนูู ูููู ุงูุนุงูุฑู", "ุนุงูุฑ ุจู ุณููู ุจู ุนุงูุฑ ุณูููู ููุตูุช", "ุนุจุฏุงูุฑุญูู ุงุญูุฏ ููุฒู ุนุจุฏุงููุชุงุญ", "ุนูู ุจู ุณุนุฏ ุจู ูุณูู ุณุนูุฏ ุงูุฑุงุดุฏู", "ุนูุถ ุจู ูุญูุฏ ุจู ุนูุถ ุฎุงุฏู ุงููููุจู", "ุบุงูู ุจู ูุญูุฏ ุจู ุณููู ูุณูู ุงูุฌููุจู", "ุบุงูู ุจู ูุญูุฏ ุจู ูุจุงุฑู ุจุฎูุช ุฌุฏุงุฏ", "ูุญูุฏ ุงุญูุฏ ูุญููุฏ ุนุจุฏุงูุญููุฏ", "ูุญูุฏ ุจู ูุณูู ุจู ูุญูุฏ ุจุฎูุช ูุณู", "ูุงูู ุจู ูุญูุฏ ุจู ุณุงูู ุณููู ูุณู", "ููุฏุงู ุจู ุงุญูุฏ ุจู ุนุจุฏุงููู ูุญูุฏ ุฌุฏุงุฏ"],
        "5_2": ["ุฃุญูุฏ ุจู ุณุนูุฏ ุจู ูุณูู ุฃุญูุฏ ุฌุฏุงุฏ", "ุฃูุฌุฏ ุจู ุณุนูุฏ ุจู ุฎููุณ ุณุนูุฏ ุงูุดูููู", "ุงูุจุฑุงุก ุงุญูุฏ ุณููุญ ุนูู ุณูุฏ", "ุฎุงูุฏ ุจู ุฃุญูุฏ ุจู ูุณูู ูุญูุฏ ูุณู", "ุฎุงูุฏ ุจู ูุญูุฏ ุจู ูุณูู ุณูููุฑ ุฎูุงุฑ", "ุณุงูู ุจู ุญูุฏ ุจู ูุจุฎูุช ุญูุงุฏู ุฌุฏุงุฏ", "ุณุงูู ุจู ุนูุถ ุจู ุณุงูู ูุญูุฏ ูุณู", "ุณุงูู ุจู ูุงูู ุจู ุณุงูู ุนูุถู ุฌุฏุงุฏ", "ุณุนูุฏ ุจู ุจุฎูุช ุจู ุนุจุฏู ุจุฎูุช ุฎูุงุฑ", "ุณุนูุฏ ุจู ุฎุงูุฏ ุจู ุจุฎูุช ุฒุงูุฏ ูุณู", "ุณุนูุฏ ุจู ุตุงูุญ ุจู ุณููู ุนูู ุจูุช ุฌุฏุงุฏ", "ุณููุงู ุจู ูุงุฌู ุจู ุณุงูู ุณุนุฏ ุฎูุงุฑ", "ุณููู ุจู ูุนูุฑ ุจู ุณููู ูุณูู ุฌุฏุงุฏ ุงููุซูุฑู", "ุตุงูุญ ูุญูู ูุณูู", "ุตูุฑ ุจู ูุญูุฏ ุจู ุงูุนุจุฏ ุณููู ุฌุฏุงุฏ", "ุนุจุฏุงูุฑุญูู ุณุงูู ูุญูุฏ ุงุญูุฏ ููุณู ุงููุฒูู", "ูุญูุฏ ุจู ุจุฎูุช ุจู ุงุญูุฏ ูุญูุฏ ูุณู", "ูุญูุฏ ุจู ุณุงูู ุจู ุณููู ูุทุฑ ุฌุฏุงุฏ", "ูุญูุฏ ุจู ุนุงูุฑ ุจู ูุญูุฏ ุงุญูุฏ ุงููุณููู", "ูุญูุฏ ุจู ุบุงุฒู ุจู ูููุด ุฌุนูุฏ ุฌุฏุงุฏ ุงููุซูุฑู", "ูุญูุฏ ุจู ููุฏ ุจู ุณุงูู ุฎููุชู ูุณู", "ูุณูู ุจู ุจุฎูุช ุจู ุนุจุฏู ุจุฎูุช ุฎูุงุฑ"],
        "8_2": ["ุงูุฌููุฏู ุจู ููุธุงู ุจู ุณูููุงู ุณุงูู ุงููุงุตุฑู", "ุงูุฎุทุงุจ ูุญูุฏ ุตูุงุญ ูุญููุฏ", "ุชููู ุจู ููุซู ุจู ุงุญูุฏ ุณุนูุฏ ูุณู ุงููุซูุฑู", "ุฎุงูุฏ ุจู ูุญูุฏ ุจู ุณุงูู ุงุญูุฏ ุฌุฏุงุฏ", "ุฎุงูุฏ ุจู ูุงูู ุจู ุณุงูู ุนูุถู ุฌุฏุงุฏ", "ุฑูุงุถ ุจู ุจุฎูุช ุจู ูุฑุฌ ุดููุงู ุนุฒุงุจ", "ุณุงูู ุจู ุญุงูุฏ ุจู ูุณูู ูุญูุฏ ูุณู ุงููุซูุฑู", "ุณุงูู ุจู ุนุงูุฑ ุจู ุณุงูู ุธูููุฑ ุฌุฏุงุฏ", "ุณุงูู ุณููู ุณุงูู ูุฑุฌ ุงูุฎูุงุฑ", "ุณุนุฏ ุจู ุญุงูู ุจู ุฃุญูุฏ ุฎูุงุฑ", "ุณุนูุฏ ุจู ุณุงูู ุจู ุณุนูุฏ ุณููู ูุณู", "ุณุนูุฏ ุจู ูุงุฆู ุจู ุนุจุฏุงููู ูุญูุฏ ุฌุฏุงุฏ", "ุณุนูุฏ ุจู ุฑุงูุงู ุจู ูุณูู ูุญูุฏ ูุณู ุงููุซูุฑู", "ุตุงูุญ ุจู ุนูู ุจู ุตุงูุญ ุนูู ุงููุณููู", "ุทุงุฑู ุงุญูุฏ ุถุงุญู ุนุจุฏุงูุบูู ุญุณูู", "ุทูุงู ุจู ูุณูู ุจู ุณุนูุฏ ุณููู ูุณู", "ุนุงูุฑ ุจู ุงุญูุฏ ุจู ูุจุฎูุช ูุณูู ูููู ุฎูุงุฑ", "ุนุจุฏุงูุนุฒูุฒ ุจู ููุตู ุจู ุณุนูุฏ ูุญูุฏ ุงููุณููู", "ุนุจุฏุงููู ุจู ุณุงูู ุจู ุฃุญูุฏ ุตุงูุญ ูุณู", "ุนูู ุฌูุนุงู ุณุงูู ุณุนูุฏ ููุณู", "ุนูุฑ ุจู ูุญูุฏ ุจู ุณูููุงู ูุญูุฏ ุงูููุฏู", "ุบููู ุจู ุนูุฑู ุจู ุบููู ุณุงูู ุฎูุงุฑ", "ูุงูู ูููุฏ ูุญูุฏ ููุงุฏ", "ูุญูุฏ ุจู ุณุนูุฏ ุจู ุตุงูุญ ุฃุญูุฏ ุฌุฏุงุฏ", "ูุญูุฏ ุจู ูุณูู ุจู ุณููู ูุญูุฏ ุงูุฑุงุดุฏู", "ูุณูู ุจู ุงุญูุฏ ุจู ูุณูู ุงูุฑุญุงุจู ุฌุฏุงุฏ", "ูุงุตุฑ ุจู ูุฑุดุฏ ุจู ุจุฎูุช ุนุจุฏุงููู ูุณู", "ูุงู ุจู ูุญูุฏ ุจู ุณุงูู ุจุฎูุช ุงููุซูุฑู", "ููุณู ุจู ุณุงูู ุจู ุนุงูุฑ ุณูุงูู ุฌุฏุงุฏ", "ูุญูุฏ ุญุณูู ุงูุนูู"]
        // (ููููู ุฅุถุงูุฉ ุจุงูู ุงูุตููู ููุง ุจููุณ ุงูููุท)
    };

    function populateStudents(cls) {
        const sel = document.getElementById('studentSelect');
        sel.innerHTML = '<option value="" disabled selected>-- ุงุฎุชุฑ ุงูุทุงูุจ --</option>';
        if(studentsData[cls]) {
            studentsData[cls].forEach(s => { let o = document.createElement('option'); o.value=s; o.innerText=s; sel.appendChild(o); });
            document.getElementById('studentGroup').classList.remove('hidden');
            document.getElementById('dataFields').classList.remove('hidden');
        } else { alert("ุณูุชู ุฅุถุงูุฉ ุฃุณูุงุก ูุฐุง ุงูุตู ูุฑูุจุงู"); }
    }

    document.getElementById('updateForm').onsubmit = async (e) => {
        e.preventDefault();
        const btn = document.getElementById('submitBtn');
        btn.disabled = true; btn.innerText = "ุฌุงุฑู ุงูุญูุธ...";
        try {
            await db.collection("updates").add({
                class: document.getElementById('classSelect').value,
                student: document.getElementById('studentSelect').value,
                phone: document.getElementById('newPhone').value,
                relation: document.getElementById('relation').value,
                at: new Date().toLocaleString('ar-OM')
            });
            alert("โ ุชู ุชุญุฏูุซ ุจูุงูุงุช ุงูุทุงูุจ ุจูุฌุงุญ");
            location.reload();
        } catch(e) { alert("โ ุฎุทุฃ ูู ุงูุฅุฑุณุงูุ ุชุฃูุฏ ูู ุฅุนุฏุงุฏุงุช Firebase Rules"); btn.disabled = false; }
    };

    function openAdmin() {
        if(prompt("ูููุฉ ุงูุณุฑ:") === "Yazeed2026") {
            document.getElementById('userView').classList.add('hidden');
            document.getElementById('adminView').classList.remove('hidden');
            loadAdminData();
        }
    }

    function loadAdminData() {
        db.collection("updates").orderBy("at", "desc").onSnapshot(snap => {
            const body = document.getElementById('adminTableBody');
            const stats = {}; body.innerHTML = "";
            snap.forEach(doc => {
                const d = doc.data();
                stats[d.class] = (stats[d.class] || 0) + 1;
                body.innerHTML += `<tr><td>${d.at}</td><td>${d.class.replace('_','/')}</td><td>${d.student}</td><td>${d.phone}</td><td>${d.relation}</td></tr>`;
            });
            renderStats(stats);
        });
    }

    function renderStats(counts) {
        const container = document.getElementById('statsContainer');
        container.innerHTML = "";
        for (let cls in classTotals) {
            let done = counts[cls] || 0;
            let total = classTotals[cls];
            let pc = Math.round((done/total)*100);
            container.innerHTML += `
                <div class="stat-card">
                    <small>ุตู ${cls.replace('_','/')}</small>
                    <div style="font-weight:bold">${done} ูู ${total} ูุญุฏุซ</div>
                    <div class="progress-bar"><div class="progress-fill" style="width:${pc}%"></div></div>
                    <small style="color:gray">${pc}% ููุชูู</small>
                </div>`;
        }
    }

    function searchTable() {
        let q = document.getElementById('adminSearch').value.toLowerCase();
        let rows = document.getElementById('adminTableBody').rows;
        for(let r of rows) { r.style.display = r.innerText.toLowerCase().includes(q) ? "" : "none"; }
    }

    function exportToExcel() {
        let wb = XLSX.utils.table_to_book(document.getElementById('dataTable'));
        XLSX.writeFile(wb, "ุชุญุฏูุซุงุช_ูุฏุฑุณุฉ_ูุฒูุฏ.xlsx");
    }
</script>
</body>
</html>
